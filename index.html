<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tech.Care</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg:#F5F7FA;

      --white:#FFFFFF;
      --card:#FFFFFF;
      --card-border:#E7EEF5;

      --ink:#0B2230;
      --muted:#6B7A86;

      --teal:#01F0D0;
      --teal-ink:#045b52;

      --lilac:#F4F1FF;

      --blue-tint:#E6F6FF;
      --pink-tint:#FFE6F1;
      --peach-tint:#FFE9E9;

      --active:#D9FBF6;
      --hover:#F2F6FA;
      --navIdle:#6B7A86;

      --scroll-thumb: rgba(7, 38, 53, 0.9);
      --scroll-track: rgba(7, 38, 53, 0.10);

      --shadow: 0 8px 22px rgba(16, 24, 40, 0.04);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
    }

    .page{
      width: 1600px;
      max-width: 100%;
      margin: 0 auto;
    }

    .frame{ padding:18px; }

    /* ================= HEADER ================= */
    .app-header{
      width:100%;
      height:72px;
      background:var(--white);
      border-radius:70px;
      border:1px solid var(--card-border);
      box-shadow: 0 1px 2px rgba(16,24,40,.06);
      overflow:hidden;
    }
    .header-inner{
      height:72px;
      display:flex;
      align-items:center;
      padding-left:32px;
      padding-right:22px;
    }
    .logo-slot{
      width:210px;
      height:48px;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      flex:0 0 auto;
    }
    .logo-slot img,
    .logo-slot svg{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }

    nav.primary-nav{
      display:flex;
      align-items:center;
      gap:19px;
      margin-left:236px;
      height:72px;
      flex:0 0 auto;
    }
    .nav-item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 16px;
      border-radius:999px;
      text-decoration:none;
      white-space:nowrap;
      font-weight:600;
      font-size:14px;
      line-height:1;
      color:var(--navIdle);
      transition: background .15s ease, color .15s ease;
    }
    .nav-item:hover{ background:var(--hover); color:var(--ink); }
    .nav-item.active{ background:var(--active); color:var(--ink); }
    .nav-ico{ width:15.51px; height:17px; display:block; flex:0 0 auto; }

    .header-right{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap:14px;
      height:72px;
    }
    .profile{
      display:flex;
      align-items:center;
      gap:10px;
      text-decoration:none;
      color:var(--ink);
      padding:6px 10px;
      border-radius:999px;
    }
    .profile:hover{ background:var(--hover); }
    .avatar{
      width:34px; height:34px;
      border-radius:50%;
      object-fit:cover;
      border:2px solid #fff;
      box-shadow:0 0 0 1px rgba(7,38,53,.12);
    }
    .ptext{ display:flex; flex-direction:column; line-height:1.05; }
    .pname{ font-size:13px; font-weight:700; }
    .prole{ font-size:11px; font-weight:500; color:var(--muted); margin-top:3px; }

    .hdr-icon-btn{
      width:34px; height:34px;
      border:0;
      background:transparent;
      border-radius:999px;
      display:grid;
      place-items:center;
      cursor:pointer;
      color:rgba(7,38,53,.65);
      transition: background .15s ease, color .15s ease;
    }
    .hdr-icon-btn:hover{ background:var(--hover); color:var(--ink); }
    .hdr-icon-btn svg{ width:20px; height:20px; display:block; }
    /* ================= END HEADER ================= */

    .content{ margin-top:32px; }

    .main{
      display:grid;
      grid-template-columns: 367px 766px 367px;
      gap:32px;
      align-items:start;
    }

    .card{
      background:var(--card);
      border-radius:16px;
      border:1px solid var(--card-border);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    /* ================= LEFT: Patients ================= */
    .left-boarder{
      height:1054px;
      display:flex;
      flex-direction:column;
    }

    .patients-header{
      padding:16px 18px 10px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .patients-title{
      font-size:18px;
      font-weight:900;
      letter-spacing:-0.01em;
    }

    .icon-btn{
      width:32px; height:32px;
      border:none;
      background:transparent;
      display:grid;
      place-items:center;
      cursor:pointer;
      padding:0;
      border-radius:10px;
    }
    .icon-btn:hover{ background:var(--hover); }

    .patients-list{
      padding: 0 10px 14px 10px;
      overflow:auto;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .patient{
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      transition: background .15s ease;
      min-height:54px;
    }
    .patient:hover{ background:#F4F7FB; }
    .patient.active{ background:var(--active); }

    .p-avatar{
      width:36px; height:36px;
      border-radius:50%;
      object-fit:cover;
      flex:0 0 auto;
    }

    .p-meta{ min-width:0; }
    .p-name{
      font-size:12px;
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .p-sub{
      font-size:10px;
      color:var(--muted);
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .p-more{
      margin-left:auto;
      width:32px; height:32px;
      border-radius:10px;
      display:grid;
      place-items:center;
      color:#6B7A86;
    }

 /* ================= MIDDLE ================= */
    .middle{
      display:flex;
      flex-direction:column;
      gap:32px;
    }

    .diagnosis-history{
      height:673px;
      padding:20px;
    }

    .diagnostic-list{
      height:349px;
      padding:20px;
      display:flex;
      flex-direction:column;
    }

    .section-title{
      font-size:24px;
      font-weight:800;
      margin: 0 0 14px 0;
      color:var(--ink);
    }

    .bp-card{
      width:726px;
      height:298px;
      background:#F4F0FE;
      border-radius:12px;
      padding:16px;
      display:grid;
      grid-template-columns: 1fr 208px;
      gap:14px;
      align-items:start;
    }

    .bp-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:8px;
    }
    .bp-label{ font-size:12px; font-weight:800; color:var(--ink); }

    .bp-filter{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      color:var(--muted);
      font-weight:700;
    }
    .bp-filter select{
      font-size:12px;
      border:none;
      background:transparent;
      outline:none;
      cursor:pointer;
      color:#425563;
      font-weight:700;
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      padding:6px 0;
    }
    .bp-filter .select-caret{
      width:16px; height:16px;
      opacity:.9;
      pointer-events:none;
      display:block;
    }

    .bp-chart canvas{
      width:100% !important;
      height:187px !important;
      display:block;
    }

    .bp-stats{
      padding: 4px 6px;
      display:flex;
      flex-direction:column;
      gap:18px;
    }
    .stat{ display:flex; flex-direction:column; gap:6px; }
    .dotrow{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      font-weight:800;
      color:#2B3A46;
    }
    .dot{ width:14px; height:14px; border-radius:50%; background:#999; }
    .stat .value{ font-size:24px; font-weight:800; line-height:1; color:#2B3A46; }
    .stat .note{
      font-size:12px;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:6px;
      font-weight:700;
    }
    .trend-icon{ width:96px; height:14px; flex:0 0 auto; }

    .vitals{
      margin-top:14px;
      display:flex;
      gap:21px;
      flex-wrap:nowrap;
    }

    .vital{
      width:228px;
      height:242px;
      border-radius:12px;
      padding:16px;
      border:1px solid rgba(255,255,255,0.55);
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
    }

    .vital.blue{ background:#E0F3FA; }
    .vital.pink{ background:#FFE6E9; }
    .vital.peach{ background:#FFE6F1; }

    .badge{
      width:96px; height:96px;
      border-radius:999px;
      background:rgba(255,255,255,0.9);
      border:1px solid rgba(11,34,48,0.10);
      display:grid;
      place-items:center;
      margin-bottom:10px;
    }
    .badge img{ width:32px; height:32px; object-fit:contain; display:block; }

    .vital .label{ font-size:14px; font-weight:700; color:#2B3A46; }
    .vital .big{ font-size:32px; font-weight:800; margin-top:6px; }
    .vital .small{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      display:flex;
      align-items:center;
      gap:6px;
      font-weight:700;
    }
    .vital .small img{ width:14px; height:14px; }

    .table-head{
      height:48px;
      display:grid;
      grid-template-columns: 200px 1fr 150px;
      gap:10px;
      padding:0 16px;
      border-radius:24px;
      background:#F3F6FA;
      font-size:12px;
      font-weight:800;
      color:#425563;
      align-items:center;
    }
    .table-head > div:last-child{ text-align:right; }

    .scroll-area{
      margin-top:10px;
      overflow:auto;
      padding-right:8px;
      flex:1;
    }

    .row{
      height:59px;
      display:grid;
      grid-template-columns: 200px 1fr 150px;
      gap:10px;
      padding:0 16px;
      font-size:12px;
      color:#2B3A46;
      border-radius:12px;
      margin-bottom:7px;
      align-items:center;
    }
    .row:hover{ background:#F4F7FB; }
    .row strong{ font-weight:800; }
    .row > div:last-child{ text-align:right; }

    /* ================= RIGHT COLUMN ================= */
    .right-col{
      display:flex;
      flex-direction:column;
      gap:32px;
    }

    .patient-profile{
      height:740px;
      padding:22px 20px 18px 20px;
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    .big-avatar{
      width:128px;
      height:128px;
      border-radius:50%;
      object-fit:cover;
      background:#fff;
      margin-top:6px;
      border:10px solid #F1F4F8;
      box-shadow: 0 18px 34px rgba(2, 8, 23, 0.10);
    }
    .patient-name{
      margin-top:10px;
      font-size:18px;
      font-weight:900;
      letter-spacing:-0.01em;
      color:#2B3A46;
      text-align:center;
    }

    .info-list{
      width:100%;
      margin-top:10px;
      overflow:auto;
      padding-right:8px;
      flex:1;
    }

    .info{
      display:grid;
      grid-template-columns: 34px 1fr;
      gap:10px;
      align-items:center;
      padding:10px 2px;
      border-radius:12px;
    }

    .info-ico{
      width:34px; height:34px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(11,34,48,0.12);
      display:grid;
      place-items:center;
    }
    .info-ico img{ width:16px; height:16px; object-fit:contain; display:block; }

    .k{ font-size:9px; color:var(--muted); font-weight:900; margin-bottom:2px; }
    .v{ font-size:11px; font-weight:900; color:#2B3A46; }

    .primary-btn{
      margin: 14px auto 4px;
      width: 260px;
      max-width: 100%;
      border:none;
      cursor:pointer;
      padding:12px 14px;
      border-radius:999px;
      font-weight:900;
      font-size:11px;
      color:var(--teal-ink);
      background:var(--teal);
      box-shadow: 0 14px 26px rgba(1, 240, 208, 0.22);
    }

    .lab{
      height:296px;
      padding:18px 18px 14px 18px;
      display:flex;
      flex-direction:column;
    }
    .lab-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .lab-title{ font-size:16px; font-weight:900; color:#2B3A46; }

    .lab-list{
      overflow:auto;
      padding-right:8px;
      flex:1;
    }
    .lab-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      font-size:11px;
      font-weight:800;
      color:#425563;
      border-radius:10px;
      margin-bottom:6px;
    }
    .lab-item:hover{ background:#F2F5F9; }
    .dl{
      width:34px; height:34px;
      border-radius:10px;
      border:none;
      background:transparent;
      display:grid;
      place-items:center;
      cursor:pointer;
      color:#0B2230;
    }
    .dl:hover{ background:#EEF4F8; }

    /* Scrollbars */
    .patients-list::-webkit-scrollbar,
    .scroll-area::-webkit-scrollbar,
    .info-list::-webkit-scrollbar,
    .lab-list::-webkit-scrollbar{
      width: 10px;
    }
    .patients-list::-webkit-scrollbar-track,
    .scroll-area::-webkit-scrollbar-track,
    .info-list::-webkit-scrollbar-track,
    .lab-list::-webkit-scrollbar-track{
      background: var(--scroll-track);
      border-radius: 999px;
    }
    .patients-list::-webkit-scrollbar-thumb,
    .scroll-area::-webkit-scrollbar-thumb,
    .info-list::-webkit-scrollbar-thumb,
    .lab-list::-webkit-scrollbar-thumb{
      background: var(--scroll-thumb);
      border-radius: 999px;
      border: 3px solid rgba(245,247,250,0.95);
      background-clip: content-box;
    }
    .patients-list, .scroll-area, .info-list, .lab-list{
      scrollbar-color: var(--scroll-thumb) var(--scroll-track);
      scrollbar-width: thin;
    }

    @media (max-width: 1200px){
      .main{ grid-template-columns: 1fr; }
      .left-boarder, .diagnosis-history, .diagnostic-list, .patient-profile, .lab{ height:auto; }
      nav.primary-nav{ display:none; }
      .primary-btn{ width:100%; }
      .header-inner{ padding-left:18px; }
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="frame">

      <header class="app-header">
        <div class="header-inner">

          <!-- keep your logo img src EXACTLY -->
          <div class="logo-slot">
            <img src="C:\Users\Nkuna HI\Downloads\TestLogo.svg" alt="Tech.Care"/>
          </div>

          <nav class="primary-nav" aria-label="Primary">
            <a class="nav-item" href="#">
              <svg class="nav-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M4 10.5 12 4l8 6.5V20a1 1 0 0 1-1 1h-5v-6H10v6H5a1 1 0 0 1-1-1v-9.5Z" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"/>
              </svg>
              <span>Overview</span>
            </a>

            <a class="nav-item active" href="#">
              <svg class="nav-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M16.5 19.5c0-2.2-2-4-4.5-4s-4.5 1.8-4.5 4" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
                <path d="M12 13.2a3.3 3.3 0 1 0 0-6.6 3.3 3.3 0 0 0 0 6.6Z" stroke="currentColor" stroke-width="1.7"/>
              </svg>
              <span>Patients</span>
            </a>

            <a class="nav-item" href="#">
              <svg class="nav-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M7 3v3M17 3v3" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
                <path d="M4.5 8.2h15" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
                <path d="M6 5.5h12a2 2 0 0 1 2 2V19a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7.5a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"/>
              </svg>
              <span>Schedule</span>
            </a>

            <a class="nav-item" href="#">
              <svg class="nav-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M20 14a4 4 0 0 1-4 4H9l-4 3v-3.5A4.5 4.5 0 0 1 4 14V8a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v6Z" stroke="currentColor" stroke-width="1.7" stroke-linejoin="round"/>
              </svg>
              <span>Message</span>
            </a>

            <a class="nav-item" href="#">
              <svg class="nav-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M4 7.5A2.5 2.5 0 0 1 6.5 5h11A2.5 2.5 0 0 1 20 7.5v9A2.5 2.5 0 0 1 17.5 19h-11A2.5 2.5 0 0 1 4 16.5v-9Z" stroke="currentColor" stroke-width="1.7"/>
                <path d="M4 9h16" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
                <path d="M7 14h6" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/>
              </svg>
              <span>Transactions</span>
            </a>
          </nav>

          <div class="header-right">
            <a class="profile" href="#" aria-label="Profile">
              <img class="avatar" src=https://www.expertortho.co.uk/images/profile-head.webp alt="User avatar">
              <div class="ptext">
                <span class="pname">Dr. Jose Simmons</span>
                <span class="prole">General Practitioner</span>
              </div>
            </a>

            <button class="hdr-icon-btn" type="button" aria-label="Settings">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 15.3a3.3 3.3 0 1 0 0-6.6 3.3 3.3 0 0 0 0 6.6Z" stroke="currentColor" stroke-width="1.7"/>
                <path d="M19.4 13a7.9 7.9 0 0 0 .1-2l2-1.2-2-3.4-2.3.6a7.8 7.8 0 0 0-1.7-1l-.4-2.3H9l-.4 2.3a7.8 7.8 0 0 0-1.7 1L4.6 6.4l-2 3.4 2 1.2a7.9 7.9 0 0 0 0 2l-2 1.2 2 3.4 2.3-.6c.5.4 1.1.8 1.7 1l.4 2.3h6l.4-2.3c.6-.2 1.2-.6 1.7-1l2.3.6 2-3.4-2-1.2Z"
                      stroke="currentColor" stroke-width="1.3" stroke-linejoin="round" opacity=".95"/>
              </svg>
            </button>

            <button class="hdr-icon-btn" type="button" aria-label="More">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 6.5v.1M12 12v.1M12 17.5v.1" stroke="currentColor" stroke-width="2.6" stroke-linecap="round"/>
              </svg>
            </button>
          </div>

        </div>
      </header>

      <div class="content">
        <div class="main">

          <!-- LEFT -->
          <aside class="card left-boarder">
            <div class="patients-header">
              <div class="patients-title">Patients</div>
              <button class="icon-btn" aria-label="Search">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                  <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#425563" stroke-width="2"/>
                  <path d="M16.8 16.8 21 21" stroke="#425563" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
            <div class="patients-list" id="patientsList"></div>
          </aside>

          <!-- MIDDLE -->
          <main class="middle">

            <section class="card diagnosis-history">
              <div class="section-title">Diagnosis History</div>

              <div class="bp-card">
                <div>
                  <div class="bp-top">
                    <div class="bp-label">Blood Pressure</div>
                    <div class="bp-filter">
                      <select id="rangeSelect" aria-label="Select range">
                        <option value="6">Last 6 months</option>
                        <option value="3">Last 3 months</option>
                        <option value="12">Last 12 months</option>
                      </select>
                      <img class="select-caret" alt="" src="expand_more_FILL0_wght300_GRAD0_opsz24%20(1).svg">
                    </div>
                  </div>
                  <div class="bp-chart">
                    <canvas id="bpChart"></canvas>
                  </div>
                </div>

                <div class="bp-stats">
                  <div class="stat">
                    <div class="dotrow"><span class="dot" id="dotSys"></span> Systolic</div>
                    <div class="value" id="systolicValue">—</div>
                    <div class="note" id="systolicNote">—</div>
                  </div>

                  <div class="stat">
                    <div class="dotrow"><span class="dot" id="dotDia"></span> Diastolic</div>
                    <div class="value" id="diastolicValue">—</div>
                    <div class="note" id="diastolicNote">—</div>
                  </div>
                </div>
              </div>

              <div class="vitals">
                <div class="vital blue">
                  <div class="badge">
                    <img alt="Respiratory Rate" src="C:\Users\Nkuna HI\Downloads\respiratory rate.svg">
                  </div>
                  <div class="label">Respiratory Rate</div>
                  <div class="big" id="rrValue">—</div>
                  <div class="small" id="rrNote">—</div>
                </div>

                <div class="vital pink">
                  <div class="badge">
                    <img alt="Temperature" src="C:\Users\Nkuna HI\Downloads\Temperature.svg">
                  </div>
                  <div class="label">Temperature</div>
                  <div class="big" id="tempValue">—</div>
                  <div class="small" id="tempNote">—</div>
                </div>

                <div class="vital peach">
                  <div class="badge">
                    <img alt="Heart Rate" src="C:\Users\Nkuna HI\Downloads\HeartBPM.svg">
                  </div>
                  <div class="label">Heart Rate</div>
                  <div class="big" id="hrValue">—</div>
                  <div class="small" id="hrNote">—</div>
                </div>
              </div>
            </section>

            <section class="card diagnostic-list">
              <div class="section-title">Diagnostic List</div>

              <div class="table-head">
                <div>Problem/Diagnosis</div>
                <div>Description</div>
                <div>Status</div>
              </div>

              <div class="scroll-area" id="diagnosticRows"></div>
            </section>

          </main>

          <!-- RIGHT -->
          <aside class="right-col">

            <section class="card patient-profile">
              <img class="big-avatar" id="profilePic" alt="Patient profile picture" />
              <div class="patient-name" id="profileName">—</div>

              <div class="info-list" id="profileInfo"></div>

              <button class="primary-btn" type="button">Show All Information</button>
            </section>

            <section class="card lab">
              <div class="lab-head">
                <div class="lab-title">Lab Results</div>
              </div>

              <div class="lab-list" id="labList"></div>
            </section>

          </aside>

        </div>
      </div>

    </div>
  </div>

  <script>
    class Html {
      static escape(value){
        return String(value ?? "")
          .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
          .replaceAll('"',"&quot;").replaceAll("'","&#039;");
      }
      static formatDob(value){
        if(!value) return "—";
        const dt = new Date(value);
        if(String(dt) === "Invalid Date") return value;
        return dt.toLocaleDateString(undefined,{year:"numeric",month:"long",day:"numeric"});
      }
    }

    class ApiClient {
      constructor({ url, username, password }){
        this.url = url;
        this.username = username;
        this.password = password;
      }
      async fetchPatients(){
        const headers = new Headers();
        headers.set("Authorization", "Basic " + btoa(this.username + ":" + this.password));
        const res = await fetch(this.url, { headers });
        if(!res.ok) throw new Error("API error: " + res.status);

        const data = await res.json();
        const list = Array.isArray(data) ? data : (data.patients || data.data || []);
        if(!Array.isArray(list) || list.length === 0) throw new Error("Empty API response");
        return PatientNormalizer.normalizePatients(list);
      }
    }

    class PatientNormalizer {
      static normalizePatients(list){
        return list.map((p, idx) => this.normalizePatient(p, idx));
      }

      static normalizePatient(p, idx){
        const name = p.name || p.full_name || `${p.first_name || "Patient"} ${p.last_name || (idx+1)}`;
        const gender = p.gender || "—";
        const age = p.age ?? "—";
        const profile_picture = p.profile_picture || p.profile_image || p.avatar || "https://i.pravatar.cc/200?img=47";

        const diagnosis_history = (p.diagnosis_history || p.history || []).map(h => ({
          month: h.month || h.date || h.period || "—",
          systolic: h?.blood_pressure?.systolic?.value ?? h.systolic ?? 0,
          diastolic: h?.blood_pressure?.diastolic?.value ?? h.diastolic ?? 0,
          heart_rate: h?.heart_rate?.value ?? h.heart_rate ?? 0,
          heart_note: h?.heart_rate?.levels ?? h.heart_note ?? "",
          respiratory_rate: h?.respiratory_rate?.value ?? h.respiratory_rate ?? 0,
          rr_note: h?.respiratory_rate?.levels ?? h.rr_note ?? "",
          temperature: h?.temperature?.value ?? h.temperature ?? 0,
          temp_note: h?.temperature?.levels ?? h.temp_note ?? ""
        }));

        const diagnostic_list = (p.diagnostic_list || p.diagnosis_list || p.diagnostics || []).map(d => ({
          problem: d.name || d.problem || d.diagnosis || "—",
          description: d.description || d.details || "—",
          status: d.status || d.state || "—"
        }));

        const lab_results = (p.lab_results || p.labs || []).map(x => typeof x === "string" ? x : (x.name || x.title || "Lab"));

        return {
          id: p.id || p.patient_id || name.toLowerCase().replace(/\s+/g,"-"),
          name,
          gender,
          age,
          date_of_birth: p.date_of_birth || p.dob || "",
          phone: p.phone_number || p.phone || "—",
          emergency: p.emergency_contact || p.emergency || "—",
          insurance: p.insurance_provider || p.insurance || "—",
          profile_picture,
          lab_results,
          diagnosis_history,
          diagnostic_list
        };
      }
    }

    class PatientStore {
      constructor(){
        this.patients = [];
        this.selectedId = null;
      }
      setPatients(patients){ this.patients = patients || []; }
      selectById(id){ this.selectedId = id; }
      getSelected(){ return this.patients.find(p => p.id === this.selectedId) || null; }
      findDefault(){
        return this.patients.find(p => (p.name || "").toLowerCase().includes("jessica")) || this.patients[0] || null;
      }
    }

    class PatientsListView {
      constructor(rootEl, onSelect){
        this.rootEl = rootEl;
        this.onSelect = onSelect;
      }
      render(patients, selectedId){
        this.rootEl.innerHTML = "";

        if(!patients || patients.length === 0){
          const empty = document.createElement("div");
          empty.style.padding = "14px 10px";
          empty.style.color = "#6B7A86";
          empty.style.fontSize = "12px";
          empty.textContent = "Loading patients…";
          this.rootEl.appendChild(empty);
          return;
        }

        patients.forEach(p => {
          const el = document.createElement("div");
          el.className = "patient" + (p.id === selectedId ? " active" : "");
          el.innerHTML = `
            <img class="p-avatar" src="${p.profile_picture}" alt="${Html.escape(p.name)}" />
            <div class="p-meta">
              <div class="p-name">${Html.escape(p.name)}</div>
              <div class="p-sub">${Html.escape(p.gender)}, ${Html.escape(String(p.age))}</div>
            </div>
            <div class="p-more" aria-hidden="true">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M6 12h.01M12 12h.01M18 12h.01" stroke="#6b7a86" stroke-width="3" stroke-linecap="round"/>
              </svg>
            </div>
          `;
          el.addEventListener("click", () => this.onSelect(p.id));
          this.rootEl.appendChild(el);
        });

        const active = this.rootEl.querySelector(".patient.active");
        if(active) active.scrollIntoView({ block: "nearest" });
      }
    }

    class ProfileView {
      constructor({ picEl, nameEl, infoEl }){
        this.picEl = picEl;
        this.nameEl = nameEl;
        this.infoEl = infoEl;
      }

      render(patient){
        if(!patient){
          this.picEl.removeAttribute("src");
          this.nameEl.textContent = "—";
          this.infoEl.innerHTML = "";
          return;
        }

        this.picEl.src = patient.profile_picture;
        this.nameEl.textContent = patient.name;

        this.infoEl.innerHTML = `
          ${this.#infoRow("Date Of Birth", Html.formatDob(patient.date_of_birth), this.#iconCalendar())}
          ${this.#infoRow("Gender", patient.gender || "—", this.#iconGender(patient.gender))}
          ${this.#infoRow("Contact Info.", patient.phone || "—", this.#iconPhone())}
          ${this.#infoRow("Emergency Contacts", patient.emergency || "—", this.#iconEmergency())}
          ${this.#infoRow("Insurance Provider", patient.insurance || "—", this.#iconInsurance())}
        `;
      }

      #infoRow(k, v, iconHtml){
        return `
          <div class="info">
            <div class="info-ico">${iconHtml}</div>
            <div>
              <div class="k">${Html.escape(k)}</div>
              <div class="v">${Html.escape(v || "—")}</div>
            </div>
          </div>
        `;
      }

      #iconGender(gender){
        const g = String(gender || "").toLowerCase();
        const src = g.startsWith("m") ? "MaleIcon.svg" : "FemaleIcon.svg";
        return `<img src="${src}" alt="">`;
      }
      #iconPhone(){ return `<img src="C:\Users\Nkuna HI\Downloads\PhoneIcon.svg" alt="">`; }
      #iconInsurance(){ return `<img src="C:\Users\Nkuna HI\Downloads\PhoneIcon.svg" alt="">`; }

      #iconCalendar(){ return `<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M7 3v3M17 3v3" stroke="#425563" stroke-width="2" stroke-linecap="round"/><path d="M4 8h16" stroke="#425563" stroke-width="2" stroke-linecap="round"/><path d="M6 6h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" stroke="#425563" stroke-width="2"/></svg>`; }
      #iconEmergency(){ return `<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 22s8-4 8-10V7l-8-4-8 4v5c0 6 8 10 8 10Z" stroke="#425563" stroke-width="2"/><path d="M12 8v5" stroke="#425563" stroke-width="2" stroke-linecap="round"/><path d="M12 17h.01" stroke="#425563" stroke-width="3" stroke-linecap="round"/></svg>`; }
    }

    class DiagnosticsView {
      constructor(rowsEl){ this.rowsEl = rowsEl; }
      render(patient){
        this.rowsEl.innerHTML = "";
        if(!patient) return;

        (patient.diagnostic_list || []).forEach(d => {
          const row = document.createElement("div");
          row.className = "row";
          row.innerHTML = `
            <div><strong>${Html.escape(d.problem)}</strong></div>
            <div>${Html.escape(d.description)}</div>
            <div><strong>${Html.escape(d.status)}</strong></div>
          `;
          this.rowsEl.appendChild(row);
        });
      }
    }

    class LabResultsView {
      constructor(listEl){ this.listEl = listEl; }
      render(patient){
        this.listEl.innerHTML = "";
        if(!patient) return;

        (patient.lab_results || []).forEach(name => {
          const item = document.createElement("div");
          item.className = "lab-item";
          item.innerHTML = `
            <div>${Html.escape(name)}</div>
            <button class="dl" type="button" aria-label="Download ${Html.escape(name)}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M12 3v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M8 11l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5 21h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          `;
          this.listEl.appendChild(item);
        });
      }
    }

    class DiagnosisHistoryView {
      constructor({
        rangeSelectEl,
        chartCanvasEl,
        dotSysEl, dotDiaEl,
        systolicValueEl, diastolicValueEl,
        systolicNoteEl, diastolicNoteEl,
        rrValueEl, rrNoteEl,
        tempValueEl, tempNoteEl,
        hrValueEl, hrNoteEl
      }){
        this.rangeSelectEl = rangeSelectEl;
        this.chartCanvasEl = chartCanvasEl;

        this.dotSysEl = dotSysEl;
        this.dotDiaEl = dotDiaEl;

        this.systolicValueEl = systolicValueEl;
        this.diastolicValueEl = diastolicValueEl;
        this.systolicNoteEl = systolicNoteEl;
        this.diastolicNoteEl = diastolicNoteEl;

        this.rrValueEl = rrValueEl;
        this.rrNoteEl = rrNoteEl;
        this.tempValueEl = tempValueEl;
        this.tempNoteEl = tempNoteEl;
        this.hrValueEl = hrValueEl;
        this.hrNoteEl = hrNoteEl;

        this.chart = null;
      }

      bindRangeChange(handler){
        this.rangeSelectEl.addEventListener("change", handler);
      }

      render(patient){
        if(!patient){
          this.#setText(this.systolicValueEl, "—");
          this.#setText(this.diastolicValueEl, "—");
          this.#setHTML(this.systolicNoteEl, "—");
          this.#setHTML(this.diastolicNoteEl, "—");
          this.#setText(this.rrValueEl, "—");
          this.#setHTML(this.rrNoteEl, "—");
          this.#setText(this.tempValueEl, "—");
          this.#setHTML(this.tempNoteEl, "—");
          this.#setText(this.hrValueEl, "—");
          this.#setHTML(this.hrNoteEl, "—");
          return;
        }

        const monthsCount = parseInt(this.rangeSelectEl.value, 10) || 6;
        const history = (patient.diagnosis_history || []).slice(-monthsCount);

        const labels = history.map(h => h.month);
        const systolic = history.map(h => Number(h.systolic)||0);
        const diastolic = history.map(h => Number(h.diastolic)||0);

        const latest = history[history.length-1] || {};
        const sys = Number(latest.systolic)||0;
        const dia = Number(latest.diastolic)||0;

        this.#setText(this.systolicValueEl, sys || "—");
        this.#setText(this.diastolicValueEl, dia || "—");

        this.#setHTML(this.systolicNoteEl, this.#noteWithArrow(this.#noteSys(sys)));
        this.#setHTML(this.diastolicNoteEl, this.#noteWithArrow(this.#noteDia(dia)));

        this.#setText(this.rrValueEl, latest.respiratory_rate ? `${latest.respiratory_rate} bpm` : "—");
        this.#setHTML(this.rrNoteEl, this.#noteWithArrow(latest.rr_note || "—"));

        this.#setText(this.tempValueEl, latest.temperature ? `${Number(latest.temperature).toFixed(1)}°F` : "—");
        this.#setHTML(this.tempNoteEl, this.#noteWithArrow(latest.temp_note || "—"));

        this.#setText(this.hrValueEl, latest.heart_rate ? `${latest.heart_rate} bpm` : "—");
        this.#setHTML(this.hrNoteEl, this.#noteWithArrow(latest.heart_note || "—"));

        const sysColor = "#E660C5";
        const diaColor = "#7C6AF2";
        this.dotSysEl.style.background = sysColor;
        this.dotDiaEl.style.background = diaColor;

        if(this.chart){
          this.chart.data.labels = labels;
          this.chart.data.datasets[0].data = systolic;
          this.chart.data.datasets[1].data = diastolic;
          this.chart.update();
          return;
        }

        Chart.defaults.font.family = "Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";

        this.chart = new Chart(this.chartCanvasEl, {
          type: "line",
          data: {
            labels,
            datasets: [
              { label:"Systolic", data:systolic, borderColor:sysColor, pointBackgroundColor:sysColor, pointBorderColor:"#fff", pointBorderWidth:2, tension:0.35, borderWidth:3 },
              { label:"Diastolic", data:diastolic, borderColor:diaColor, pointBackgroundColor:diaColor, pointBorderColor:"#fff", pointBorderWidth:2, tension:0.35, borderWidth:3 }
            ]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{ legend:{display:false}, tooltip:{ enabled:true } },
            scales:{
              x:{ grid:{display:false}, ticks:{ color:"#6B7A86", font:{ size:10 } }, border:{display:false} },
              y:{ min:60, max:180, ticks:{ stepSize:20, color:"#6B7A86", font:{ size:10 } }, grid:{ color:"rgba(11,34,48,0.06)" }, border:{display:false} }
            }
          }
        });
      }

      #setText(el, value){ el.textContent = String(value); }
      #setHTML(el, html){ el.innerHTML = html; }

      #noteWithArrow(note){
        if(note === "Higher than Average"){
          return `<img class="trend-icon" alt="" src="ArrowUp%20(1).svg"> ${note}`;
        }
        if(note === "Lower than Average"){
          return `<img class="trend-icon" alt="" src="ArrowDown%20(1).svg"> ${note}`;
        }
        return Html.escape(note);
      }

      #noteSys(v){
        if(!v) return "—";
        if(v >= 140) return "Higher than Average";
        if(v <= 110) return "Lower than Average";
        return "Normal";
      }
      #noteDia(v){
        if(!v) return "—";
        if(v > 90) return "Higher than Average";
        if(v < 80) return "Lower than Average";
        return "Normal";
      }
    }

    class App {
      constructor({ apiClient, fallbackPatients }){
        this.apiClient = apiClient;
        this.fallbackPatients = fallbackPatients;

        this.store = new PatientStore();

        this.patientsListView = new PatientsListView(
          document.querySelector("#patientsList"),
          (id) => this.selectPatient(id)
        );

        this.profileView = new ProfileView({
          picEl: document.querySelector("#profilePic"),
          nameEl: document.querySelector("#profileName"),
          infoEl: document.querySelector("#profileInfo"),
        });

        this.diagnosticsView = new DiagnosticsView(document.querySelector("#diagnosticRows"));
        this.labResultsView = new LabResultsView(document.querySelector("#labList"));

        this.historyView = new DiagnosisHistoryView({
          rangeSelectEl: document.querySelector("#rangeSelect"),
          chartCanvasEl: document.querySelector("#bpChart"),
          dotSysEl: document.querySelector("#dotSys"),
          dotDiaEl: document.querySelector("#dotDia"),
          systolicValueEl: document.querySelector("#systolicValue"),
          diastolicValueEl: document.querySelector("#diastolicValue"),
          systolicNoteEl: document.querySelector("#systolicNote"),
          diastolicNoteEl: document.querySelector("#diastolicNote"),
          rrValueEl: document.querySelector("#rrValue"),
          rrNoteEl: document.querySelector("#rrNote"),
          tempValueEl: document.querySelector("#tempValue"),
          tempNoteEl: document.querySelector("#tempNote"),
          hrValueEl: document.querySelector("#hrValue"),
          hrNoteEl: document.querySelector("#hrNote"),
        });

        this.historyView.bindRangeChange(() => this.renderAll());
      }

      async init(){
        this.patientsListView.render([], null);

        const patients = await this.#loadPatients();
        this.store.setPatients(patients);

        const defaultPatient = this.store.findDefault();
        this.store.selectById(defaultPatient?.id || null);

        this.renderAll();
      }

      selectPatient(id){
        this.store.selectById(id);
        this.renderAll();
      }

      renderAll(){
        const selected = this.store.getSelected();

        this.patientsListView.render(this.store.patients, this.store.selectedId);
        this.profileView.render(selected);
        this.diagnosticsView.render(selected);
        this.labResultsView.render(selected);
        this.historyView.render(selected);
      }

      async #loadPatients(){
        try{
          return await this.apiClient.fetchPatients();
        }catch(err){
          console.warn("API failed, using fallback:", err.message);
          return this.fallbackPatients;
        }
      }
    }

    /* ✅ FULL FALLBACK PATIENTS LIST (matches XD screenshot names) */
    const FALLBACK_PATIENTS = [
      {
        id: "emily-williams",
        name: "Emily Williams",
        gender: "Female",
        age: 18,
        date_of_birth: "2006-02-14",
        phone: "(415) 555-0001",
        emergency: "(415) 555-9001",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=12",
        lab_results: ["Blood Tests", "CT Scans", "Radiology Reports", "X-Rays", "Urine Test"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "ryan-johnson",
        name: "Ryan Johnson",
        gender: "Male",
        age: 45,
        date_of_birth: "1979-05-09",
        phone: "(415) 555-0002",
        emergency: "(415) 555-9002",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=33",
        lab_results: ["Blood Tests", "CT Scans", "X-Rays"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "brandon-mitchell",
        name: "Brandon Mitchell",
        gender: "Male",
        age: 36,
        date_of_birth: "1988-11-01",
        phone: "(415) 555-0003",
        emergency: "(415) 555-9003",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=52",
        lab_results: ["Blood Tests", "Radiology Reports"],
        diagnosis_history: [],
        diagnostic_list: []
      },

      /* Selected patient (full data like screenshot) */
      {
        id: "jessica",
        name: "Jessica Taylor",
        gender: "Female",
        age: 28,
        date_of_birth: "1996-08-23",
        phone: "(415) 555-1234",
        emergency: "(415) 555-5678",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=47",
        lab_results: ["Blood Tests", "CT Scans", "Radiology Reports", "X-Rays", "Urine Test"],
        diagnosis_history: [
          { month:"Oct, 2023", systolic:125, diastolic:110, heart_rate:78, heart_note:"Lower than Average", respiratory_rate:20, rr_note:"Normal", temperature:98.6, temp_note:"Normal" },
          { month:"Nov, 2023", systolic:120, diastolic:70,  heart_rate:78, heart_note:"Lower than Average", respiratory_rate:20, rr_note:"Normal", temperature:98.6, temp_note:"Normal" },
          { month:"Dec, 2023", systolic:160, diastolic:110, heart_rate:78, heart_note:"Lower than Average", respiratory_rate:20, rr_note:"Normal", temperature:98.6, temp_note:"Normal" },
          { month:"Jan, 2024", systolic:115, diastolic:90,  heart_rate:78, heart_note:"Lower than Average", respiratory_rate:20, rr_note:"Normal", temperature:98.6, temp_note:"Normal" },
          { month:"Feb, 2024", systolic:150, diastolic:70,  heart_rate:78, heart_note:"Lower than Average", respiratory_rate:20, rr_note:"Normal", temperature:98.6, temp_note:"Normal" },
          { month:"Mar, 2024", systolic:160, diastolic:78,  heart_rate:78, heart_note:"Lower than Average", respiratory_rate:20, rr_note:"Normal", temperature:98.6, temp_note:"Normal" }
        ],
        diagnostic_list: [
          { problem:"Hypertension", description:"Chronic high blood pressure", status:"Under Observation" },
          { problem:"Type 2 Diabetes", description:"Insulin resistance and elevated blood sugar", status:"Cured" },
          { problem:"Asthma", description:"Recurrent episodes of bronchial constriction", status:"Inactive" }
        ]
      },

      {
        id: "samantha-johnson",
        name: "Samantha Johnson",
        gender: "Female",
        age: 56,
        date_of_birth: "1968-03-22",
        phone: "(415) 555-0004",
        emergency: "(415) 555-9004",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=24",
        lab_results: ["Blood Tests", "CT Scans"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "ashley-martinez",
        name: "Ashley Martinez",
        gender: "Female",
        age: 54,
        date_of_birth: "1970-07-18",
        phone: "(415) 555-0005",
        emergency: "(415) 555-9005",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=20",
        lab_results: ["Radiology Reports", "X-Rays"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "olivia-brown",
        name: "Olivia Brown",
        gender: "Female",
        age: 32,
        date_of_birth: "1992-10-05",
        phone: "(415) 555-0006",
        emergency: "(415) 555-9006",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=16",
        lab_results: ["Blood Tests", "Urine Test"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "tyler-davis",
        name: "Tyler Davis",
        gender: "Male",
        age: 19,
        date_of_birth: "2005-01-11",
        phone: "(415) 555-0007",
        emergency: "(415) 555-9007",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=14",
        lab_results: ["Blood Tests"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "kevin-anderson",
        name: "Kevin Anderson",
        gender: "Male",
        age: 30,
        date_of_birth: "1994-04-30",
        phone: "(415) 555-0008",
        emergency: "(415) 555-9008",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=60",
        lab_results: ["CT Scans", "X-Rays"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "dylan-thompson",
        name: "Dylan Thompson",
        gender: "Male",
        age: 36,
        date_of_birth: "1988-12-12",
        phone: "(415) 555-0009",
        emergency: "(415) 555-9009",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=57",
        lab_results: ["Radiology Reports"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "nathan-evans",
        name: "Nathan Evans",
        gender: "Male",
        age: 58,
        date_of_birth: "1966-09-02",
        phone: "(415) 555-0010",
        emergency: "(415) 555-9010",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=48",
        lab_results: ["Blood Tests", "CT Scans", "Urine Test"],
        diagnosis_history: [],
        diagnostic_list: []
      },
      {
        id: "mike-nolan",
        name: "Mike Nolan",
        gender: "Male",
        age: 31,
        date_of_birth: "1993-06-25",
        phone: "(415) 555-0011",
        emergency: "(415) 555-9011",
        insurance: "Sunrise Health Assurance",
        profile_picture: "https://i.pravatar.cc/200?img=64",
        lab_results: ["X-Rays", "Urine Test"],
        diagnosis_history: [],
        diagnostic_list: []
      }
    ];

    const apiClient = new ApiClient({
      url: "https://fedskillstest.coalitiontechnologies.workers.dev",
      username: "coalition",
      password: "skills-test"
    });

    const app = new App({ apiClient, fallbackPatients: FALLBACK_PATIENTS });
    app.init();
  </script>
</body>
</html>
